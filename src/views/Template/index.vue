<template>
  <div :class="$style.container">
    <GnzsHeader :mainTitle="localization.title" :mainRoute="getMainRoute" :currentTitle="getCurrentTitle(routeId)"
      :editableTitle="false" :isFullScreen="true">
      <template #buttons>
        <GnzsButton type="cancel" @click="goToMainRoute">{{
            getHeaderBtnCancelText
        }}</GnzsButton>
        <GnzsButton type="primary" @click="onSaveClick">{{ getHeaderBtnPrimaryText }}</GnzsButton>
      </template>
    </GnzsHeader>
    <Section>
      <div :class="$style.orgHeader">{{ localization.views.template.description }}</div>
      <hr :class="$style.gnzsHr" />
      <div :class="$style.inputContainer">
        <div :class="$style.orgColumn">
          <div :class="$style.inputWrapper">
            <div :class="$style.rowFlex">
              <div :class="$style.inputDesc">{{ localization.views.newTemplate.inputs.name }}</div>
              <GnzsInput v-model="currItem.name" :class="[$style.inputName, $style.orgInput]" positive-only />
            </div>

            <div :class="$style.rowFlex">
              <div :class="$style.inputDesc">{{ localization.views.newTemplate.inputs.prefix }}</div>
              <GnzsInput v-model="currItem.prefix" :class="[$style.inputName, $style.orgInput]" positive-only />
            </div>

            <div :class="$style.rowFlex">
              <div :class="$style.inputDesc">{{ localization.views.newTemplate.inputs.suffix }}</div>
              <GnzsInput v-model="currItem.suffix" :class="[$style.inputName, $style.orgInput]" positive-only />
            </div>

            <div :class="$style.rowFlex">
              <div :class="$style.inputDesc">{{ localization.views.newTemplate.inputs.next_number }}</div>
              <GnzsInput v-model="currItem.next_number" :class="[$style.inputName, $style.orgInput]" positive-only />
            </div>

            <div :class="$style.rowFlex">
              <div :class="$style.inputDesc">{{ localization.views.newTemplate.inputs.number_length }}</div>
              <GnzsInput v-model="currItem.number_length" :class="[$style.inputName, $style.orgInput]" positive-only />
            </div>

            <div :class="$style.rowFlex">
              <div :class="$style.inputDesc">{{ localization.views.newTemplate.inputs.url }}</div>
              <GnzsInput v-model="currItem.url" :class="[$style.inputName, $style.orgInput]" positive-only />
            </div>


            <div :class="$style.rowFlex">
              <div :class="$style.inputDesc">{{ localization.views.newTemplate.inputs.is_active }}</div>
              <GnzsSwitcher v-model="currItem.is_active" :class="[$style.inputName, $style.orgInput]" positive-only />
            </div>

            <div :class="$style.rowFlex">
              <div :class="$style.inputDesc">{{ localization.views.newTemplate.inputs.document_type }}</div>
              <GnzsDropdown v-model="currItem.document_type" :class="[$style.inputName, $style.orgInput]"
                positive-only />
            </div>

            <div :class="$style.rowFlex">
              <GnzsCheckBox :label="localization.views.newTemplate.inputs.required_sign"
                v-model="currItem.required_sign" />
            </div>
          </div>
        </div>
      </div>
      <hr :class="$style.gnzsHr" />
      <GnzsButton :type="`remove`" @click="onRemoveClick">
        {{ localization.views.template.buttons.delete }}
      </GnzsButton>
    </Section>
  </div>

</template>

<script setup>
import { storeToRefs } from 'pinia';
import { onMounted } from 'vue';
import { computed } from "@vue/reactivity";
import { useRoute } from 'vue-router';

import PATHS from "@/router/paths"

import { useIframeStore } from '@/stores/iframe.store';
import { useHeaderStore } from "@/stores/header.store";
import { useDocTemplateStore } from "@/stores/doctemplate.store";
import { useInitializationStore } from "@/stores/initialization.store";

import Section from "@/gnzs-controls/gnzs-section/gnzs-section.vue";
import GnzsHeader from "@/gnzs-controls/gnzs-header/gnzs-header.vue";
import GnzsButton from "@/gnzs-controls/gnzs-button/gnzs-button.vue";
import GnzsInput from "@/gnzs-controls/gnzs-input/gnzs-input.vue";
import GnzsCheckBox from "@/gnzs-controls/gnzs-checkbox/gnzs-checkbox.vue";
import GnzsDropdown from "@/gnzs-controls/gnzs-dropdown/gnzs-dropdown.vue";
import GnzsSwitcher from '@/gnzs-controls/gnzs-switcher/gnzs-switcher.vue';

const localization = computed(() => initializationStore.localization);

const { getCurrentTitle } = storeToRefs(useDocTemplateStore());
const { loadItems, getCurrentItem } = useDocTemplateStore();

const { openConfirmModal } = useIframeStore();

const { setCurrentRouteId, isNotMainPage, goToMainRoute } = useHeaderStore();
const initializationStore = useInitializationStore();

const { saveItem } = useDocTemplateStore();

const route = useRoute();
const routeId = +route.params.id;
const currItem = getCurrentItem(routeId);

// computed
const getMainRoute = computed(() => isNotMainPage ? PATHS.ADVANCED_SETTINGS.name : "");
const getHeaderBtnCancelText = computed(() => initializationStore.localization.buttons.cancel);
const getHeaderBtnPrimaryText = computed(() => initializationStore.localization.buttons.save);

const onSaveClick = () => {
  if (currItem) {
    saveItem(routeId, currItem);
    goToMainRoute();
  }
}

const onRemoveClick = async () => {
  await openConfirmModal({
    name: '',
    id: routeId,
    confirmEventName: 'deleteTemplate',
    text: localization.value.confirm.deleteQuestion.template,
    declineText: localization.value.buttons.cancel,
    acceptText: localization.value.buttons.yes
  });
}

onMounted(() => {
  loadItems()
  setCurrentRouteId(routeId)
})

</script>

<style lang="scss" module>
@import './style.scss';
</style>